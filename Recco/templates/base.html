<!doctype html>
{% load static %}
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{% block title %}ReCo{% endblock %}</title>
  <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
  <link rel="stylesheet" href="{% static 'css/style.css' %}">
  {% block extra_head %}{% endblock %}
</head>
<body>
  <header class="site-header">
    <div class="container nav-container">
      <a class="brand" href="{% url 'home' %}">
        <img src="{% static 'images/logo.svg' %}" alt="Logotipo ReCo" height="32" loading="lazy">
        <span>ReCo</span>
      </a>

      <div class="nav-actions">
        {% if request.user.is_authenticated %}
          <a class="btn btn-primary btn-sm" href="{% url 'marketplace:create' %}">Anunciar item</a>
          <span class="welcome">Olá, {{ request.user.first_name|default:request.user.username }}</span>

          <div class="nav-dropdown">
            <button class="btn btn-secondary btn-sm" type="button" data-nav-toggle>
              Menu
              <span aria-hidden="true">▾</span>
            </button>
            <div class="nav-dropdown-menu" role="menu">
              <a role="menuitem" href="{% url 'home' %}">Início</a>
              <a role="menuitem" href="{% url 'marketplace:index' %}">Marketplace</a>
              <a role="menuitem" href="{% url 'usuario:index' %}">Usuário</a>
              <a role="menuitem" href="{% url 'perfil:index' %}">Perfil</a>
              <a role="menuitem" href="{% url 'marketplace:chats' %}">Chats</a>
              <a role="menuitem" href="{% url 'usuario:logout' %}">Sair</a>
            </div>
          </div>
        {% else %}
          <a class="btn btn-outline-light btn-sm" href="{% url 'usuario:login' %}">Entrar</a>
          <a class="btn btn-light btn-sm" href="{% url 'usuario:register' %}">Criar conta</a>
        {% endif %}
      </div>
    </div>
  </header>

  {% if messages %}
    <div class="container message-stack">
      {% for message in messages %}
        <div class="alert alert-{{ message.tags|default:'info' }} shadow-sm" role="alert">
          {{ message }}
        </div>
      {% endfor %}
    </div>
  {% endif %}

  <main class="site-main">
    {% block content %}{% endblock %}
  </main>

  <footer class="site-footer">
    <div class="container">
      <p>Reutiliza &amp; Conecta — conectando doadores e iniciativas que transformam eletrônicos em oportunidade.</p>
      <small>&copy; {% now "Y" %} ReCo</small>
    </div>
  </footer>

  <script>
    (function(){
      const dropdown = document.querySelector('.nav-dropdown');
      if (!dropdown) return;
      const menu = dropdown.querySelector('.nav-dropdown-menu');
      const toggle = dropdown.querySelector('[data-nav-toggle]');
      if (!menu || !toggle) return;

      function closeMenu(){
        dropdown.classList.remove('open');
        toggle.setAttribute('aria-expanded', 'false');
      }

      toggle.addEventListener('click', function(){
        const isOpen = dropdown.classList.toggle('open');
        toggle.setAttribute('aria-expanded', isOpen);
      });

      document.addEventListener('click', function(event){
        if (!dropdown.contains(event.target)) {
          closeMenu();
        }
      });
    })();
  </script>
  {% block extra_js %}{% endblock %}
</body>
</html>
