{% extends 'base.html' %}

{% block title %}{{ donation.title }} — Doações{% endblock %}

{% block content %}
  <div class="container d-flex flex-column gap-4">
    <section class="section-card">
      <div class="d-flex flex-wrap justify-content-between align-items-start gap-3">
        <div>
          <p class="text-muted mb-1">{{ donation.city|default:'Cidade não informada' }}</p>
          <h1 class="h3 mb-1">{{ donation.title }}</h1>
          <span class="pill">{{ donation.get_condition_display }}</span>
        </div>
        <div class="d-flex gap-2 flex-wrap">
          <a class="btn btn-outline-secondary" href="{% url 'marketplace:index' %}">Voltar</a>
          {% if user.is_authenticated %}
            <a class="btn btn-primary" href="{% url 'marketplace:chat' donation.pk %}">Abrir chat</a>
          {% else %}
            <a class="btn btn-primary" href="{% url 'usuario:login' %}">Entrar para conversar</a>
          {% endif %}
        </div>
      </div>

      {% if donation.image %}
        <div class="donation-hero-image mt-4">
          <img src="{{ donation.image.url }}" alt="Imagem de {{ donation.title }}">
        </div>
      {% endif %}

      <p class="mt-3">{{ donation.description|default:"Sem descrição"|linebreaks }}</p>

      <dl class="row mt-4">
        <dt class="col-md-3">Doador</dt>
        <dd class="col-md-9">{{ donation.donor.get_full_name|default:donation.donor.username }}</dd>

        <dt class="col-md-3">Email de contato</dt>
        <dd class="col-md-9">
          {% if donation.contact_email %}
            <a href="mailto:{{ donation.contact_email }}">{{ donation.contact_email }}</a>
          {% else %}
            —
          {% endif %}
        </dd>

        <dt class="col-md-3">Telefone</dt>
        <dd class="col-md-9">{{ donation.contact_phone|default:"—" }}</dd>
      </dl>
    </section>

    {% if related %}
      <section>
        <h2 class="h5 mb-3">Outros itens recentes</h2>
        <div class="card-grid">
          {% for item in related %}
            <article class="donation-card">
              {% if item.image %}
                <div class="donation-card__media">
                  <img src="{{ item.image.url }}" alt="Imagem de {{ item.title }}">
                </div>
              {% endif %}
              <h3 class="h6 mb-1">{{ item.title }}</h3>
              <p class="text-muted small mb-2">{{ item.city|default:'Cidade não informada' }}</p>
              <p class="mb-2">{{ item.description|truncatechars:120 }}</p>
              <a class="btn btn-link p-0" href="{% url 'marketplace:detail' item.pk %}">Ver detalhes</a>
            </article>
          {% endfor %}
        </div>
      </section>
    {% endif %}
  </div>
{% endblock %}